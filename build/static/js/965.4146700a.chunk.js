"use strict";(self.webpackChunkagnoworksphere=self.webpackChunkagnoworksphere||[]).push([[965],{346:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(43),r=t(985),l=t(266),n=t(16),i=t(378),o=t(557),c=t(726),d=t(984),u=t(579);const m=a.memo(function(e){let{iconName:s,iconClass:t,label:a,value:l}=e;return(0,u.jsx)("div",{className:"bg-card rounded-lg border border-border p-4",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"text-sm text-text-secondary",children:a}),(0,u.jsx)("p",{className:"text-2xl font-bold text-foreground",children:l})]}),(0,u.jsx)(r.A,{name:s,size:24,className:t})]})})}),x=e=>{let{project:s,userRole:t}=e;const[x,p]=(0,a.useState)(""),[g,h]=(0,a.useState)("all"),[f,j]=(0,a.useState)("dueDate"),[N,b]=(0,a.useState)([]),[v,y]=(0,a.useState)(!1),[k,w]=(0,a.useState)(!1),[C,D]=(0,a.useState)([]),[S,A]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(s){const e=setTimeout(()=>{P()},100);return()=>clearTimeout(e)}},[null===s||void 0===s?void 0:s.id]);const P=async()=>{try{if(A(!0),s.tasks){const e=("string"===typeof s.tasks?JSON.parse(s.tasks):s.tasks).map((e,t)=>({id:`task-${t+1}`,title:e.title,description:e.description,status:e.status,priority:e.priority,assignee:"Unassigned",dueDate:new Date(Date.now()+7*(t+1)*24*60*60*1e3).toISOString().split("T")[0],progress:"completed"===e.status?100:"in-progress"===e.status?50:0,subtasks:e.subtasks||[],tags:[e.priority,s.name.split(" ")[0]],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}));D(e)}else D([])}catch(e){console.error("Failed to load tasks:",e),D([])}finally{setTimeout(()=>A(!1),50)}},T=async e=>{try{const t=e.map(e=>({title:e.title,description:e.description,status:e.status,priority:e.priority,subtasks:e.subtasks||[]})),a=(e=>{if(!e||0===e.length)return 0;const s=e.filter(e=>"completed"===e.status).length;return Math.round(s/e.length*100)})(e),r={...s,tasks:JSON.stringify(t),progress:a};await d.default.projects.update(s.id,r)&&(console.log("Project tasks updated successfully"),localStorage.setItem("currentProject",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("projectUpdated",{detail:{project:r}})))}catch(t){console.error("Failed to update project tasks:",t),alert("Failed to save task changes. Please try again.")}},z=e=>{switch(e){case"high":return"text-error bg-error/10";case"medium":return"text-warning bg-warning/10";case"low":return"text-success bg-success/10";default:return"text-text-secondary bg-muted"}},I=(0,a.useDeferredValue)(x),O=(0,a.useMemo)(()=>{const e=(I||"").toLowerCase();return C.filter(s=>{const t=s.title.toLowerCase().includes(e)||s.description.toLowerCase().includes(e),a="all"===g||s.status===g;return t&&a})},[C,I,g]),M=(0,a.useMemo)(()=>{const e={high:3,medium:2,low:1};return[...O].sort((s,t)=>{switch(f){case"dueDate":return new Date(s.dueDate)-new Date(t.dueDate);case"priority":return e[t.priority]-e[s.priority];case"status":return s.status.localeCompare(t.status);case"assignee":return s.assignee.localeCompare(t.assignee);case"title":return s.title.localeCompare(t.title);default:return 0}})},[O,f]),E=(0,a.useCallback)((e,s)=>{b(t=>s?[...t,e]:t.filter(s=>s!==e))},[]),F=(0,a.useCallback)(e=>{b(e?M.map(e=>e.id):[])},[M]);(0,a.useEffect)(()=>{y(N.length>0)},[N]);const $=(0,a.useCallback)(e=>{console.log(`Performing ${e} on tasks:`,N),b([]),y(!1)},[N]),L=e=>new Date(e)<new Date&&new Date(e).toDateString()!==(new Date).toDateString(),U=(0,a.useMemo)(()=>C.filter(e=>"completed"===e.status).length,[C]),J=(0,a.useMemo)(()=>C.filter(e=>"in-progress"===e.status).length,[C]),q=(0,a.useMemo)(()=>C.filter(e=>L(e.dueDate)&&"completed"!==e.status).length,[C]);return(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[(0,u.jsx)("div",{className:"flex-1 max-w-md",children:(0,u.jsx)(n.A,{type:"search",placeholder:"Search tasks...",value:x,onChange:e=>p(e.target.value),className:"w-full"})}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)(i.A,{options:[{value:"all",label:"All Tasks"},{value:"todo",label:"To Do"},{value:"in-progress",label:"In Progress"},{value:"completed",label:"Completed"}],value:g,onChange:h,placeholder:"Filter by status",className:"w-40"}),(0,u.jsx)(i.A,{options:[{value:"dueDate",label:"Due Date"},{value:"priority",label:"Priority"},{value:"status",label:"Status"},{value:"assignee",label:"Assignee"},{value:"title",label:"Title"}],value:f,onChange:j,placeholder:"Sort by",className:"w-32"})]})]}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)(l.A,{variant:"outline",iconName:"Filter",iconPosition:"left",children:"More Filters"}),(0,u.jsx)(l.A,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>{w(!0)},children:"Add Task"})]})]}),v&&(0,u.jsx)("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("span",{className:"text-sm font-medium text-foreground",children:[N.length," task",1!==N.length?"s":""," ","selected"]}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)(l.A,{variant:"outline",size:"sm",onClick:()=>$("assign"),children:"Assign"}),(0,u.jsx)(l.A,{variant:"outline",size:"sm",onClick:()=>$("status"),children:"Change Status"}),(0,u.jsx)(l.A,{variant:"outline",size:"sm",onClick:()=>$("priority"),children:"Set Priority"}),(0,u.jsx)(l.A,{variant:"destructive",size:"sm",onClick:()=>$("delete"),children:"Delete"})]})]})}),(0,u.jsx)("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:(0,u.jsx)("div",{className:"overflow-x-auto",children:(0,u.jsxs)("table",{className:"w-full",children:[(0,u.jsx)("thead",{className:"bg-muted/50 border-b border-border",children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{className:"text-left p-4 w-12",children:(0,u.jsx)(o.S,{checked:N.length===M.length&&M.length>0,onChange:e=>F(e.target.checked),indeterminate:N.length>0&&N.length<M.length})}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Task"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Status"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Priority"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Assignee"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Due Date"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Progress"}),(0,u.jsx)("th",{className:"text-left p-4 font-medium text-foreground",children:"Actions"})]})}),(0,u.jsx)("tbody",{children:M.map(e=>(0,u.jsxs)("tr",{className:"border-b border-border hover:bg-muted/30 transition-colors",children:[(0,u.jsx)("td",{className:"p-4",children:(0,u.jsx)(o.S,{checked:N.includes(e.id),onChange:s=>E(e.id,s.target.checked)})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("h4",{className:"font-medium text-foreground hover:text-primary cursor-pointer",children:e.title}),(0,u.jsx)("p",{className:"text-sm text-text-secondary line-clamp-2",children:e.description}),e.subtasks&&e.subtasks.length>0&&(0,u.jsxs)("div",{className:"space-y-1",children:[(0,u.jsx)("p",{className:"text-xs text-text-secondary font-medium",children:"Subtasks:"}),e.subtasks.slice(0,3).map((s,t)=>(0,u.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,u.jsx)(o.S,{checked:s.completed,onChange:()=>(async(e,s)=>{const t=C.map(t=>{if(t.id===e&&t.subtasks){const e=t.subtasks.map((e,t)=>t===s?{...e,completed:!e.completed}:e),a=e.filter(e=>e.completed).length,r=e.length>0?Math.round(a/e.length*100):0;let l=t.status;return l=100===r?"completed":r>0?"in-progress":"pending",{...t,subtasks:e,progress:r,status:l}}return t});D(t),await T(t)})(e.id,t),size:"sm"}),(0,u.jsx)("span",{className:s.completed?"line-through text-text-secondary":"text-foreground",children:s.text})]},t)),e.subtasks.length>3&&(0,u.jsxs)("p",{className:"text-xs text-text-secondary",children:["+",e.subtasks.length-3," more"]})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[e.tags&&e.tags.slice(0,2).map(e=>(0,u.jsx)("span",{className:"px-2 py-1 bg-muted rounded-full text-xs text-text-secondary",children:e},e)),e.tags&&e.tags.length>2&&(0,u.jsxs)("span",{className:"text-xs text-text-secondary",children:["+",e.tags.length-2]})]})]})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsx)(i.A,{options:[{value:"pending",label:"Pending"},{value:"in-progress",label:"In Progress"},{value:"completed",label:"Completed"}],value:e.status,onChange:s=>(async(e,s)=>{const t=C.map(t=>t.id===e?{...t,status:s,progress:"completed"===s?100:"in-progress"===s?50:0}:t);D(t),await T(t)})(e.id,s),className:"w-32"})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${z(e.priority)}`,children:e.priority})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:(0,u.jsx)(r.A,{name:"User",size:16,className:"text-primary"})}),(0,u.jsx)("span",{className:"text-sm text-foreground",children:e.assignee})]})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("span",{className:"text-sm "+(L(e.dueDate)?"text-error font-medium":"text-foreground"),children:new Date(e.dueDate).toLocaleDateString()}),L(e.dueDate)&&(0,u.jsx)(r.A,{name:"AlertTriangle",size:14,className:"text-error"})]})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("div",{className:"w-16 bg-muted rounded-full h-2",children:(0,u.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})}),(0,u.jsxs)("span",{className:"text-sm text-text-secondary",children:[e.progress,"%"]})]})}),(0,u.jsx)("td",{className:"p-4",children:(0,u.jsxs)("div",{className:"flex items-center gap-1",children:[(0,u.jsx)(l.A,{variant:"ghost",size:"sm",iconName:"Eye"}),(0,u.jsx)(l.A,{variant:"ghost",size:"sm",iconName:"Edit"}),(0,u.jsx)(l.A,{variant:"ghost",size:"sm",iconName:"MoreHorizontal"})]})})]},e.id))})]})})}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,u.jsx)(m,{iconName:"CheckSquare",iconClass:"text-primary",label:"Total Tasks",value:C.length}),(0,u.jsx)(m,{iconName:"CheckCircle",iconClass:"text-success",label:"Completed",value:U}),(0,u.jsx)(m,{iconName:"Clock",iconClass:"text-warning",label:"In Progress",value:J}),(0,u.jsx)(m,{iconName:"AlertTriangle",iconClass:"text-error",label:"Overdue",value:q})]}),(0,u.jsx)(c.A,{isOpen:k,onClose:()=>w(!1),onTaskCreated:e=>{const t={id:`task-${Date.now()}`,title:e.title,description:e.description,status:"pending",priority:e.priority||"medium",assignee:e.assignee||"Unassigned",dueDate:e.dueDate||new Date(Date.now()+6048e5).toISOString().split("T")[0],progress:0,subtasks:e.subtasks||[],tags:[e.priority||"medium",s.name.split(" ")[0]],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};D(e=>[...e,t]),w(!1),T([...C,t])},projectId:null===s||void 0===s?void 0:s.id,project:s})]})}}}]);
//# sourceMappingURL=965.4146700a.chunk.js.map